//# Minecraft RMI (Remote method invocation)

Allow multiple addons to communicate by exposing an API

## Protocol

The protocol is built on top of an ACK'ed communication that specifies how to send commands and arguments
across the addon boundaries.

### Raw communication

Note that when sending scriptevents, to prevent Minecraft from trying to convert it to json, we append a "-" at
the start of the message.

1. The receiver needs to be ready to accept incoming data by listening to an agreed scriptevent.
2. The sender generates a unique identifier `id` used across all the message.
3. If the sender has any object to transfer (such as arguments or data), it must be converted to a JSON
   string (via JSON.stringify) and split into chunks of 2048 (the current limit for message).
4. The sender starts listening on the scriptevent `minescripters_rmi:${id}.sender` for incoming transactions
5. The sender starts by sending a message header as a JSON string.

```ts
interface MessageHeader {
  // Message identifier generated by the sender that identifies this whole message
  id: string;
  // Number of chunks to be sent - if any.
  chunkCount?: number;

  // Additional data - Must be kept at minimum as this whole header cannot excede the limit of 2048 characters when JSONfied
  // https://learn.microsoft.com/en-us/minecraft/creator/commands/commands/scriptevent?view=minecraft-bedrock-stable
  header: unknown;
}
```

6. The receiver receives the header, grabs the `id`.
7. If there is any chunk to be received, the receiver starts listening on `minescripters_rmi:${id}.receiver`
8. The receiver Sends and `ack` message by sending a scriptevent to `${id}.sender`
9. The sender receives the `ack` message and closes connection to `minescripters_rmi:${id}.sender` if there are no chunks to be sent.
10. If there is any chunk to be sent, the sender sends them on `minescripters_rmi:${id}.receiver`
    Note: Care must be taken into account to not execute more commands than possible. There is still no way to know if we are reaching the limit, so throttling them if required.

11. The receiver receives the chunks, concatenates and parses the result, closes `${id}.receiver`.
12. The receiver sends a final ack by sending a scriptevent to `${id}.sender`
13. The sender sees the ack and closes `${id}.sender`

This allows us to send a message across addons, with json data.
